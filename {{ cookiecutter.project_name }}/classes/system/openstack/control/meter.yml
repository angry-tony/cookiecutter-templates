{%- macro password(size=16) -%}
{% for index in range(size) %}{{ 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'|random }}{% endfor %}
{%- endmacro %}
classes:
{%- if cookiecutter.ceilometer_cluster == "True" %}
- service.keepalived.cluster.single
- service.mongodb.server.cluster
- service.haproxy.proxy.single
- service.ceilometer.server.cluster
{%- else %}
- service.mongodb.server.single
- service.ceilometer.server.single
{%- endif %}
- system.openstack.common
parameters:
  _param:
    {%- if cookiecutter.ceilometer_cluster == "True" %}
    cluster_vip_address: ${_param:mdb_vip_address}
    cluster_node01_hostname: {{ cookiecutter.mdb01_name }}
    cluster_node01_address: {{ cookiecutter.mdb01_address }}
    cluster_node02_hostname: {{ cookiecutter.mdb02_name }}
    cluster_node02_address: {{ cookiecutter.mdb02_address }}
    cluster_node03_hostname: {{ cookiecutter.mdb03_name }}
    cluster_node03_address: {{ cookiecutter.mdb03_address }}
    mongodb_master: ${_param:cluster_node01_hostname}
    mongodb_server_members:
    - host: {{ cookiecutter.mdb01_name }}
      priority: 2
    - host: {{ cookiecutter.mdb02_name }}
    - host: {{ cookiecutter.mdb03_name }}
    {%- endif %}
    mongodb_server_replica_set: ceilometer
    mongodb_ceilometer_password: {{ password(16) }}
    mongodb_admin_password: {{ password(16) }}
    # TODO: generate shared key
    mongodb_shared_key: |
      4vie+55QrhSCbxyg/a1yH7JBJIVfmAv4P6/tr8SUQGcGPIRFZCRpYqpUmleLUbK7
      iBqz+cuN9XAQQm1EGPHJK354nALM4qZYW5T2Y4z6kuUixC9Xl2LQxksFusREhhNG
      c/5cwb+dVB6bVydBPbSQ2KzcwP5UrfwCqEjnk3FGMzNO203SdExnGa2ZdzKegL3W
      1jsi59/TRXpLWmo6+YT2R5SuwG59/BnJ0VV0rUMW4+C2QujdqgjF+w6wRr7G8dNM
      jG9OsU3RdUdI+G4388soQTlhlaWxsKhLW+ZEQPrvySDxI/bKPeUFG865jkoWIZUl
      opWqT+pXxxx6R/7f6MuMci0ko0BYsPNt+Axm1QuMnWfATxgapMX+dANc+H1QMhH/
      QMGp4ipgpCeztx7kJ3nBTkWLXwBgqE2kgF3fpknqGKO2Pn2iCmQxoUcHG2RRUcrs
      7nlWqD5mir2DAsH4kleTUjlJyBJ5kRYXxsamJyCm84KEkmfMkt0q0feyFC9zs1OD
      Pf9YMb5YGWypecl3PA6EaNCCF4QgV0ul72b9wUSd9dZSTSxsVihiSej8CUQ8aePi
      FRmK45kMRVEVhtp4ShYE/bhh44OXhE4FbQ2+45AojZ9QjsHkn3AsHE7349UmVbzl
      ShfomPfc0VYnYYjAa5hilqgFyvYe5yiW6v4Rg/eEKojxgiWRVsyslZ0LwK65KYXj
      xajiJnGBbts6Uq8lVrw+4j0iwW+8dw6ivvXjg8ZiT51RsSpPY5xy06+8mbST9u7c
      qH/uWmKPD6XxkEooqwlwDYMl+AFlXXiSVFktFo8h5S76WOeRz2Sa9QF798SuhLi4
      GAtpBpigdPkfllaOUZed+BEOGB8LxkeWITzy+e9czzhYKje4KRbiEpdmaZn5f+H8
      izdFOf9y6CQJf+HLXbYktDMyEboF3QjW+kBgTXtZPU4ayQhlfcjXgPAgZgX4Zu+T
      A0T/FT11UYXnEJdT1Zc/41Gc24ng
  {%- if cookiecutter.ceilometer_cluster == "True" %}
  keepalived:
    cluster:
      instance:
        VIP:
          virtual_router_id: 230
  {%- endif %}
  linux:
    network:
      host:
        proxy_vip:
          address: ${_param:control_vip_address}
          names:
          - ${_param:cluster_public_host}
  mongodb:
    server:
      database:
        ceilometer:
          enabled: true
          password: ${_param:mongodb_ceilometer_password}
          users:
          - name: ceilometer
            password: ${_param:mongodb_ceilometer_password}
  ceilometer:
    server:
      database:
        password: ${_param:mongodb_ceilometer_password}
        host: ${_param:single_address}
      identity:
        host: ${_param:control_vip_address}
      message_queue:
        host: ${_param:control_vip_address}
