{%- macro password(size=16) -%}
{% for index in range(size) %}{{ 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'|random }}{% endfor %}
{%- endmacro %}
classes:
- service.git.client
- service.billometer.server.single
- service.postgresql.server.local
- service.python.environment
- service.rabbitmq.server.single
- service.supervisor.server.single
parameters:
  _param:
    billometer_secret_key: {{ password(16) }}
    billometer_identity_password: ${_param:keystone_billometer_password}
    billometer_identity_host: ${_param:control_vip_address}
    billometer_identity_token: ${_param:keystone_service_token}
    keystone_billometer_address: ${_param:billometer_service_host}
    postgresql_billometer_password: {{ password(16) }}
    rabbitmq_admin_name: admin
    rabbitmq_admin_password: {{ password(16) }}
    rabbitmq_secret_key: {{ password(16) }}
    rabbitmq_billometer_password: {{ password(16) }}
  postgresql:
    server:
      database:
        billometer:
          encoding: UTF8
          locale: cs_CZ
          users:
          - name: billometer
            createdb: true
            password: ${_param:postgresql_billometer_password}
            host: 127.0.0.1
            rights: all privileges
  billometer:
    server:
      source:
        engine: pkg
      metric:
        in:
          engine: graphite
          host: 10.0.106.150
          port: 80
          ssl: false
        out:
          engine: statsd
          host: 10.0.106.150
          prefix: billometer
          port: 8125
  rabbitmq:
    server:
      host:
        '/billometer':
          enabled: true
          user: billometer
          password: ${_param:rabbitmq_billometer_password}
