classes:
- system.grafana.client
- system.grafana.client.datasource.prometheus
- system.docker.client
- system.docker.swarm.stack.dashboard
- system.docker.swarm.stack.monitoring
{%- if cookiecutter.openstack_enabled == 'True' %}
- system.docker.swarm.stack.monitoring.remote_collector
{%- endif %}
{%- if cookiecutter.get('ceph_enabled', 'False') == 'True'  %}
- system.docker.swarm.stack.monitoring.remote_agent.ceph_common
{%- endif %}


#- cluster.{{ cookiecutter.cluster_name }}.infra
#- cluster.{{ cookiecutter.cluster_name }}.cicd.control

- cluster.{{ cookiecutter.cluster_name }}.infra
parameters:
  _param:
    {%- if cookiecutter.mcp_version != 'stable' and cookiecutter.mcp_version != 'testing' and cookiecutter.mcp_version != 'nightly' %}
    {%- if cookiecutter.get('local_docker_images', 'False') == 'True' %}
    docker_image_alertmanager: ${_param:aptly_server_hostname}:5000/alertmanager:${_param:apt_mk_version}
    docker_image_pushgateway: ${_param:aptly_server_hostname}:5000/pushgateway:${_param:apt_mk_version}
    docker_image_prometheus: ${_param:aptly_server_hostname}:5000/prometheus:${_param:apt_mk_version}
    docker_image_prometheus_relay: ${_param:aptly_server_hostname}:5000/prometheus_relay:${_param:apt_mk_version}
    docker_image_remote_agent: ${_param:aptly_server_hostname}:5000/telegraf:${_param:apt_mk_version}
    docker_image_remote_storage_adapter: ${_param:aptly_server_hostname}:5000/remote_storage_adapter:${_param:apt_mk_version}
    docker_image_grafana: ${_param:aptly_server_hostname}:5000/grafana:${_param:apt_mk_version}
    {%- else %}
    docker_image_alertmanager: docker-prod-local.artifactory.mirantis.com/openstack-docker/alertmanager:${_param:apt_mk_version}
    docker_image_pushgateway: docker-prod-local.artifactory.mirantis.com/openstack-docker/pushgateway:${_param:apt_mk_version}
    docker_image_prometheus: docker-prod-local.artifactory.mirantis.com/openstack-docker/prometheus:${_param:apt_mk_version}
    docker_image_remote_agent: docker-prod-local.artifactory.mirantis.com/openstack-docker/telegraf:${_param:apt_mk_version}
    docker_image_remote_storage_adapter: docker-prod-local.artifactory.mirantis.com/openstack-docker/remote_storage_adapter:${_param:apt_mk_version}
    docker_image_prometheus_relay: docker-prod-local.artifactory.mirantis.com/openstack-docker/prometheus_relay:${_param:apt_mk_version}
    docker_image_grafana: docker-prod-local.artifactory.mirantis.com/mirantis/external/grafana:${_param:apt_mk_version}
    {%- endif %}
    {%- else %}
    {%- if cookiecutter.get('local_docker_images', 'False') == 'True' %}
    docker_image_alertmanager: ${_param:aptly_server_hostname}:5000/alertmanager:latest
    docker_image_pushgateway: ${_param:aptly_server_hostname}:5000/pushgateway:latest
    docker_image_prometheus: ${_param:aptly_server_hostname}:5000/prometheus:latest
    docker_image_prometheus_relay: ${_param:aptly_server_hostname}:5000/prometheus_relay:latest
    docker_image_remote_agent: ${_param:aptly_server_hostname}:5000/telegraf:latest
    docker_image_remote_storage_adapter: ${_param:aptly_server_hostname}:5000/remote_storage_adapter:latest
    docker_image_grafana: ${_param:aptly_server_hostname}:5000/grafana:4.5.2
    {%- else %}
    docker_image_alertmanager: docker-prod-local.artifactory.mirantis.com/openstack-docker/alertmanager:latest
    docker_image_pushgateway: docker-prod-local.artifactory.mirantis.com/openstack-docker/pushgateway:latest
    docker_image_prometheus: docker-prod-local.artifactory.mirantis.com/openstack-docker/prometheus:latest
    docker_image_remote_agent: docker-prod-local.artifactory.mirantis.com/openstack-docker/telegraf:latest
    docker_image_remote_storage_adapter: docker-prod-local.artifactory.mirantis.com/openstack-docker/remote_storage_adapter:latest
    docker_image_prometheus_relay: docker-prod-local.artifactory.mirantis.com/openstack-docker/prometheus_relay:latest
    docker_image_grafana: grafana/grafana:4.5.2
    {%- endif %}
    {%- endif %}
    # Grafana client parameters
    grafana_address: ${_param:stacklight_monitor_address}
    grafana_port: 15013
    grafana_user: admin
    grafana_password: ${_param:grafana_admin_password}
    grafana_prometheus_address: ${_param:stacklight_monitor_address}
    grafana_prometheus_port: 15016
    stacklight_prometheus_port: 15010

# Switch to generic ElasticSearch
{%- if (cookiecutter.stacklight_enabled == 'True') and (cookiecutter.oss_enabled == 'True') %}
    #TODO vnaumov prepare normal fix
    haproxy_elasticsearch_bind_host: ${_param:stacklight_log_address}
    haproxy_elasticsearch_http_bind_port: 9200
    elasticsearch_bind_host: ${_param:stacklight_log_address}
    elasticsearch_binary_bind_port: 9300
    elasticsearch_cluster_name: elasticsearch
    rundeck_cis_elasticsearch_url: http://${_param:stacklight_log_address}:9200
{%- endif %}
